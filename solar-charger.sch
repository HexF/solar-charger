v 20110115 2
C 55400 36800 1 0 0 stm32l151c6.sym
{
T 61700 42500 5 10 1 1 0 6 1
refdes=U?
T 58600 40000 5 10 0 0 0 0 1
device=AD5L79Lxx
T 58600 40200 5 10 0 0 0 0 1
footprint=SOT89
}
C 54400 49700 1 0 1 connector2-2.sym
{
T 53700 51000 5 10 1 1 0 0 1
refdes=IN
T 54100 50950 5 10 0 0 0 6 1
device=CONNECTOR_2
T 54100 51150 5 10 0 0 0 6 1
footprint=SIP2N
}
C 54700 50000 1 90 0 gnd-1.sym
C 55200 39300 1 270 0 gnd-1.sym
C 62400 41700 1 90 1 gnd-1.sym
C 56900 43000 1 180 1 gnd-1.sym
C 71200 47100 1 270 0 resistor-1.sym
{
T 71600 46800 5 10 0 0 270 0 1
device=RESISTOR
T 71500 47100 5 10 1 1 270 0 1
refdes=RSENSE
T 71200 47100 5 10 0 0 270 0 1
footprint=0603
}
C 64900 50800 1 0 0 vcc-1.sym
C 60100 47000 1 0 0 gnd-1.sym
C 61300 50200 1 0 0 3.3V-plus-1.sym
C 59200 49000 1 0 0 tps71501.sym
{
T 61000 50700 5 10 1 1 0 6 1
refdes=U?
T 59800 50900 5 10 0 0 0 0 1
device=TPS71501
T 59800 51100 5 10 0 0 0 0 1
footprint=SOT89
T 60100 50000 5 10 1 1 0 0 1
value=3.3V
}
N 61300 50200 61500 50200 4
C 60200 48800 1 0 0 gnd-1.sym
C 64000 48900 1 0 0 ucc27518.sym
{
T 65800 50600 5 10 1 1 0 6 1
refdes=U?
T 64900 50100 5 10 0 0 0 0 1
device=UCC27518
T 64900 50300 5 10 0 0 0 0 1
footprint=SOT89
}
C 65000 48700 1 0 0 gnd-1.sym
C 67800 48300 1 0 1 inductor-1.sym
{
T 67600 48800 5 10 0 0 0 6 1
device=INDUCTOR
T 67400 48600 5 10 1 1 0 6 1
refdes=L?
T 67600 49000 5 10 0 0 0 6 1
symversion=0.1
}
C 71200 45900 1 0 0 gnd-1.sym
C 73900 47900 1 0 1 connector2-1.sym
{
T 73700 48900 5 10 0 0 0 6 1
device=CONNECTOR_2
T 73900 48700 5 10 1 1 0 6 1
refdes=BATT
}
N 71300 47100 71300 48100 4
T 55100 49700 9 10 1 0 0 0 3
Supply from panel:
 * +18V
 * 2W
T 67200 49200 9 10 1 0 0 0 8
Battery charging buck-boost:
 * 6 NiMH (1.45V each charged)
 * 9V in series
 * Capacity: 1100mA h to 2800mA h
 * Limit charge time to 10 h
 * Charge rate: C / 10 = 100mA
 * Trickle rate: C / 300
 * Design for maximum I = 300mA
N 69000 40200 69600 40200 4
C 66300 39200 1 0 0 ucc27518.sym
{
T 68100 40900 5 10 1 1 0 6 1
refdes=U?
T 67200 40400 5 10 0 0 0 0 1
device=UCC27518
T 67200 40600 5 10 0 0 0 0 1
footprint=SOT89
}
N 68400 40400 68500 40400 4
C 67300 39000 1 0 0 gnd-1.sym
C 69400 39000 1 90 0 inductor-1.sym
{
T 68900 39200 5 10 0 0 90 0 1
device=INDUCTOR
T 69400 39500 5 10 1 1 180 6 1
refdes=L?
T 68700 39200 5 10 0 0 90 0 1
symversion=0.1
}
C 69800 37300 1 0 0 gnd-1.sym
C 71600 37400 1 0 1 connector2-1.sym
{
T 71400 38400 5 10 0 0 0 6 1
device=CONNECTOR_2
T 71500 38200 5 10 1 1 0 6 1
refdes=OUT
}
N 69300 37900 69300 39000 4
N 66400 40000 65900 40000 4
{
T 65800 40000 5 10 1 1 0 6 1
netname=CH2_PANEL_IN
}
N 66400 40400 65900 40400 4
{
T 65800 40400 5 10 1 1 0 6 1
netname=CH2_PANEL_EN
}
N 64100 49700 63600 49700 4
{
T 63500 49600 5 10 1 1 0 6 1
netname=CH1_IN_A
}
N 64100 50100 63600 50100 4
{
T 63500 50000 5 10 1 1 0 6 1
netname=CH1_EN_A
}
C 52200 34200 0 0 0 title-C.sym
C 72000 46800 1 0 0 opamp-1.sym
{
T 72700 47600 5 10 0 0 0 0 1
device=OPAMP
T 72700 47400 5 10 1 1 0 0 1
refdes=U?
T 72700 48200 5 10 0 0 0 0 1
symversion=0.1
}
C 72400 46500 1 0 0 gnd-1.sym
C 62100 42200 1 270 0 3.3V-plus-1.sym
C 56400 42700 1 0 0 3.3V-plus-1.sym
C 55500 38600 1 90 0 3.3V-plus-1.sym
C 72300 47600 1 0 0 3.3V-plus-1.sym
C 72100 45300 1 90 0 resistor-1.sym
{
T 71700 45600 5 10 0 0 90 0 1
device=RESISTOR
T 72200 45700 5 10 1 1 0 0 1
refdes=R?
T 72100 45300 5 10 0 0 90 0 1
footprint=0603
}
N 72000 46200 72000 47000 4
C 73100 46300 1 180 0 resistor-1.sym
{
T 72800 45900 5 10 0 0 180 0 1
device=RESISTOR
T 72800 46000 5 10 1 1 180 0 1
refdes=R?
T 73100 46300 5 10 0 0 180 0 1
footprint=0603
}
N 72200 46200 72000 46200 4
N 73100 46200 73100 47200 4
N 73000 47200 73400 47200 4
{
T 73400 47200 5 10 1 1 0 0 1
netname=ISENSE1
}
C 73000 46200 1 270 0 resistor-1.sym
{
T 73400 45900 5 10 0 0 270 0 1
device=RESISTOR
T 73300 45700 5 10 1 1 0 0 1
refdes=R?
T 73000 46200 5 10 0 0 270 0 1
footprint=0603
}
C 71900 45000 1 0 0 gnd-1.sym
C 73000 45000 1 0 0 gnd-1.sym
N 72000 47400 71300 47400 4
N 68900 48400 72200 48400 4
{
T 71600 48400 5 10 1 1 0 0 1
netname=VBAT
}
N 69800 47800 69800 46700 4
C 70400 45800 1 90 0 resistor-1.sym
{
T 70000 46100 5 10 0 0 90 0 1
device=RESISTOR
T 70500 46300 5 10 1 1 180 6 1
refdes=R?
T 70400 45800 5 10 0 0 90 0 1
footprint=0603
}
C 70400 44700 1 90 0 resistor-1.sym
{
T 70000 45000 5 10 0 0 90 0 1
device=RESISTOR
T 70200 45200 5 10 1 1 180 0 1
refdes=R?
T 70400 44700 5 10 0 0 90 0 1
footprint=0603
}
N 70300 45700 70600 45700 4
{
T 70700 45600 5 10 1 1 0 0 1
netname=VSENSE1
}
C 70200 44400 1 0 0 gnd-1.sym
N 69900 37900 67900 37900 4
T 70500 36800 9 10 1 0 0 0 2
Output: +3V to +9V
Optimize for +5V
C 68000 37000 1 90 0 resistor-1.sym
{
T 67600 37300 5 10 0 0 90 0 1
device=RESISTOR
T 67800 37500 5 10 1 1 180 0 1
refdes=R?
T 68000 37000 5 10 0 0 90 0 1
footprint=0603
}
C 68000 36100 1 90 0 resistor-1.sym
{
T 67600 36400 5 10 0 0 90 0 1
device=RESISTOR
T 67800 36700 5 10 1 1 180 0 1
refdes=R?
T 68000 36100 5 10 0 0 90 0 1
footprint=0603
}
N 67900 37000 68500 37000 4
{
T 68100 37000 5 10 1 1 0 0 1
netname=VSENSE2
}
C 67800 35800 1 0 0 gnd-1.sym
T 67900 44400 9 10 1 0 0 0 10
MOSFET to decouple
the voltage divider
when charger is not
active.

Finite resistance of
partially switched
FET should be small
compared to divider
resistance.
C 53900 48100 1 90 1 capacitor-2.sym
{
T 53200 47900 5 10 0 0 270 2 1
device=POLARIZED_CAPACITOR
T 54000 47900 5 10 1 1 180 0 1
refdes=C?
T 53000 47900 5 10 0 0 270 2 1
symversion=0.1
}
C 54800 47200 1 90 0 capacitor-1.sym
{
T 54100 47400 5 10 0 0 90 0 1
device=CAPACITOR
T 54900 47900 5 10 1 1 180 0 1
refdes=C?
T 53900 47400 5 10 0 0 90 0 1
symversion=0.1
}
C 53300 47200 1 90 0 capacitor-1.sym
{
T 52600 47400 5 10 0 0 90 0 1
device=CAPACITOR
T 53000 47900 5 10 1 1 180 0 1
refdes=C?
T 52400 47400 5 10 0 0 90 0 1
symversion=0.1
}
C 55600 47200 1 90 0 capacitor-1.sym
{
T 54900 47400 5 10 0 0 90 0 1
device=CAPACITOR
T 55700 47900 5 10 1 1 180 0 1
refdes=C?
T 54700 47400 5 10 0 0 90 0 1
symversion=0.1
}
C 54500 46900 1 0 0 gnd-1.sym
C 53300 46900 1 0 0 gnd-1.sym
N 53100 48100 53700 48100 4
N 53100 47200 53700 47200 4
C 55200 48100 1 0 0 3.3V-plus-1.sym
C 55300 46900 1 0 0 gnd-1.sym
C 60700 36600 1 0 1 gnd-1.sym
C 61200 36900 1 180 0 3.3V-plus-1.sym
N 55500 39600 54700 39600 4
{
T 54600 39500 5 10 1 1 0 6 1
netname=\_RESET\_
}
C 58100 43000 1 180 1 gnd-1.sym
N 59300 48400 58900 48400 4
{
T 58500 48400 5 10 1 1 0 0 1
netname=VPANEL
}
C 60400 47300 1 90 0 zener-1.sym
{
T 59800 47700 5 10 0 0 90 0 1
device=ZENER_DIODE
T 59900 47600 5 10 1 1 90 0 1
refdes=Z?
T 60600 47600 5 10 1 1 90 0 1
value=15V
}
C 59300 48300 1 0 0 resistor-1.sym
{
T 59600 48700 5 10 0 0 0 0 1
device=RESISTOR
T 59500 48600 5 10 1 1 0 0 1
refdes=R?
T 59300 48300 5 10 0 0 0 0 1
footprint=0603
}
N 60200 48200 60200 48400 4
N 60700 48400 60200 48400 4
N 54400 50500 54800 50500 4
{
T 54900 50500 5 10 1 1 0 0 1
netname=VPANEL
}
N 58400 50600 58000 50600 4
{
T 57700 50600 5 10 1 1 0 0 1
netname=VPANEL
}
C 58400 50400 1 0 0 schottky-1.sym
{
T 58722 51072 5 10 0 0 0 0 1
device=DIODE
T 58700 50900 5 10 1 1 0 0 1
refdes=D?
T 58741 51232 5 10 0 1 0 0 1
footprint=SOD80
}
C 58400 49600 1 0 0 schottky-1.sym
{
T 58722 50272 5 10 0 0 0 0 1
device=DIODE
T 58700 50100 5 10 1 1 0 0 1
refdes=D?
T 58741 50432 5 10 0 1 0 0 1
footprint=SOD80
}
N 59300 50600 59300 49800 4
N 58400 49800 58000 49800 4
{
T 57700 49800 5 10 1 1 0 0 1
netname=VBATT
}
C 60700 48600 1 270 0 vcc-1.sym
N 53400 48100 53400 48400 4
{
T 53500 48500 5 10 1 1 90 0 1
netname=VPANEL
}
C 54400 48100 1 0 0 vcc-1.sym
C 67200 41100 1 0 0 vcc-1.sym
N 69000 41000 69000 41200 4
{
T 69100 41300 5 10 1 1 90 0 1
netname=VPANEL
}
N 65900 48400 64300 48400 4
{
T 64200 48300 5 10 1 1 0 6 1
netname=VPANEL
}
C 56400 47200 1 90 0 capacitor-1.sym
{
T 55700 47400 5 10 0 0 90 0 1
device=CAPACITOR
T 56500 47900 5 10 1 1 180 0 1
refdes=C?
T 55500 47400 5 10 0 0 90 0 1
symversion=0.1
}
N 56200 48400 56200 48100 4
{
T 56300 48500 5 10 1 1 90 0 1
netname=VBATT
}
C 56100 46900 1 0 0 gnd-1.sym
C 71300 39000 1 0 1 gnd-1.sym
N 72200 40000 72700 40000 4
{
T 72800 40000 5 10 1 1 0 0 1
netname=CH2_BATT_IN
}
N 72200 40400 72700 40400 4
{
T 72800 40400 5 10 1 1 0 0 1
netname=CH2_BATT_EN
}
C 71400 41100 1 0 1 vcc-1.sym
C 72300 39200 1 0 1 ucc27518.sym
{
T 71600 40900 5 10 1 1 0 0 1
refdes=U?
T 71400 40400 5 10 0 0 0 6 1
device=UCC27518
T 71400 40600 5 10 0 0 0 6 1
footprint=SOT89
}
N 70100 40400 70200 40400 4
N 69600 41000 69600 41200 4
{
T 69700 41300 5 10 1 1 90 0 1
netname=VBATT
}
T 67200 34900 9 16 1 0 0 0 1
MCU-based solar battery charger
T 71100 34300 9 10 1 0 0 0 1
Ben Gamari
T 52900 36300 9 10 1 0 0 0 3
PWM pins
 TIM2: PA0, PA1, PA2, PA3
 TIM3: PA6, PA7, PB0, PB1
N 55500 38400 54700 38400 4
{
T 54600 38300 5 10 1 1 0 6 1
netname=CH1_IN_A
}
N 57800 36900 57800 36100 4
{
T 57900 36000 5 10 1 1 90 6 1
netname=CH2_PANEL_IN
}
N 58200 36900 58200 36100 4
{
T 58300 36000 5 10 1 1 90 6 1
netname=CH2_BATT_IN
}
T 52900 35700 9 10 1 0 0 0 2
ADC pins:
 PA2, PA3, PA4, PA5, PA6, PA7
N 55500 37600 54700 37600 4
{
T 54600 37500 5 10 1 1 0 6 1
netname=ISENSE1
}
N 56600 36900 56600 36100 4
{
T 56700 36000 5 10 1 1 90 6 1
netname=VSENSE1
}
N 57000 36900 57000 36100 4
{
T 57100 36000 5 10 1 1 90 6 1
netname=VSENSE2
}
N 55500 40000 54700 40000 4
{
T 54600 39900 5 10 1 1 0 6 1
netname=CH1_EN_B
}
N 57400 36900 57400 36100 4
{
T 57500 36000 5 10 1 1 90 6 1
netname=CH2_PANEL_EN
}
N 58600 36900 58600 36100 4
{
T 58700 36000 5 10 1 1 90 6 1
netname=CH2_BATT_EN
}
T 58000 47500 9 10 1 0 0 0 3
Shunt regulator to
avoid over-voltage
of MOSFET drivers
N 59000 36900 59000 36100 4
{
T 59100 36000 5 10 1 1 90 6 1
netname=VSENSE1_EN
}
N 62100 41200 62700 41200 4
{
T 62800 41100 5 10 1 1 0 0 1
netname=JTMS
}
N 61000 42700 61000 43300 4
{
T 61100 43400 5 10 1 1 90 0 1
netname=JTCK
}
N 60600 42700 60600 43300 4
{
T 60700 43400 5 10 1 1 90 0 1
netname=JTDI
}
N 60200 42700 60200 43300 4
{
T 60300 43400 5 10 1 1 90 0 1
netname=JTDO
}
N 59800 42700 59800 43300 4
{
T 59900 43400 5 10 1 1 90 0 1
netname=\_JRST\_
}
N 62100 40800 62900 40800 4
{
T 63000 40700 5 10 1 1 0 0 1
netname=LED1
}
C 52700 45100 1 270 1 resistor-1.sym
{
T 53100 45400 5 10 0 0 270 6 1
device=RESISTOR
T 53000 45300 5 10 1 1 270 6 1
refdes=R?
T 52700 45100 5 10 0 0 270 6 1
footprint=0603
}
C 52600 44200 1 270 1 led-1.sym
{
T 53200 45000 5 10 0 0 270 6 1
device=LED
T 52400 44400 5 10 1 1 270 6 1
refdes=LED1
T 53400 45000 5 10 0 0 270 6 1
symversion=0.1
}
N 52800 44200 52800 43800 4
{
T 52700 43700 5 10 1 1 270 0 1
netname=LED1
}
N 62100 40400 62900 40400 4
{
T 63000 40300 5 10 1 1 0 0 1
netname=LED2
}
C 52600 46000 1 0 0 3.3V-plus-1.sym
C 53700 45100 1 270 1 resistor-1.sym
{
T 54100 45400 5 10 0 0 270 6 1
device=RESISTOR
T 54000 45300 5 10 1 1 270 6 1
refdes=R?
T 53700 45100 5 10 0 0 270 6 1
footprint=0603
}
C 53600 44200 1 270 1 led-1.sym
{
T 54200 45000 5 10 0 0 270 6 1
device=LED
T 53400 44400 5 10 1 1 270 6 1
refdes=LED2
T 54400 45000 5 10 0 0 270 6 1
symversion=0.1
}
N 53800 44200 53800 43800 4
{
T 53700 43700 5 10 1 1 270 0 1
netname=LED2
}
C 53600 46000 1 0 0 3.3V-plus-1.sym
N 62100 39600 62900 39600 4
{
T 63000 39500 5 10 1 1 0 0 1
netname=BTN2
}
N 62100 40000 62900 40000 4
{
T 63000 39900 5 10 1 1 0 0 1
netname=BTN1
}
C 55500 45300 1 270 0 switch-pushbutton-no-1.sym
{
T 55800 44900 5 10 1 1 270 0 1
refdes=BTN1
T 56100 44900 5 10 0 0 270 0 1
device=SWITCH_PUSHBUTTON_NO
}
N 55500 45300 55500 45600 4
{
T 55400 45700 5 10 1 1 270 6 1
netname=BTN1
}
C 55400 44000 1 0 0 gnd-1.sym
C 56500 45300 1 270 0 switch-pushbutton-no-1.sym
{
T 56800 44900 5 10 1 1 270 0 1
refdes=BTN2
T 57100 44900 5 10 0 0 270 0 1
device=SWITCH_PUSHBUTTON_NO
}
N 56500 45300 56500 45600 4
{
T 56400 45700 5 10 1 1 270 6 1
netname=BTN2
}
C 56400 44000 1 0 0 gnd-1.sym
C 54600 45300 1 270 0 switch-pushbutton-no-1.sym
{
T 54900 45100 5 10 1 1 270 0 1
refdes=RESET
T 55200 44900 5 10 0 0 270 0 1
device=SWITCH_PUSHBUTTON_NO
}
N 54600 45300 54600 45600 4
{
T 54500 45700 5 10 1 1 270 6 1
netname=\_RESET\_
}
C 54500 44000 1 0 0 gnd-1.sym
C 68000 48200 1 0 0 schottky-1.sym
{
T 68322 48872 5 10 0 0 0 0 1
device=DIODE
T 68300 48700 5 10 1 1 0 0 1
refdes=D?
T 68341 49032 5 10 0 1 0 0 1
footprint=SOD80
}
N 68000 48400 67800 48400 4
N 66100 50100 66500 50100 4
C 67800 47300 1 0 0 gnd-1.sym
C 64800 45500 1 0 0 gnd-1.sym
N 63900 46500 63400 46500 4
{
T 63300 46400 5 10 1 1 0 6 1
netname=CH1_IN_B
}
N 63900 46900 63400 46900 4
{
T 63300 46800 5 10 1 1 0 6 1
netname=CH1_EN_B
}
C 63800 45700 1 0 0 ucc27518.sym
{
T 65600 47500 5 10 1 1 180 0 1
refdes=U?
T 64700 46900 5 10 0 0 0 0 1
device=UCC27518
T 64700 47100 5 10 0 0 0 0 1
footprint=SOT89
}
C 64700 47600 1 0 0 vcc-1.sym
N 65900 46900 67400 46900 4
C 67000 47500 1 90 0 schottky-1.sym
{
T 66328 47822 5 10 0 0 90 0 1
device=DIODE
T 66600 48000 5 10 1 1 180 0 1
refdes=D?
T 66168 47841 5 10 0 1 90 0 1
footprint=SOD80
}
N 66700 48400 66900 48400 4
C 66700 47200 1 0 0 gnd-1.sym
N 67400 46900 67400 47800 4
C 68800 48400 1 270 0 capacitor-2.sym
{
T 69500 48200 5 10 0 0 270 0 1
device=POLARIZED_CAPACITOR
T 68900 47800 5 10 1 1 180 0 1
refdes=C?
T 69700 48200 5 10 0 0 270 0 1
symversion=0.1
}
C 68900 47200 1 0 0 gnd-1.sym
N 66500 50100 66500 48900 4
C 66700 48900 1 90 1 nmos-3.sym
{
T 66200 48300 5 10 0 0 270 2 1
device=NMOS_TRANSISTOR
T 65700 48700 5 10 1 1 0 2 1
refdes=Q?
}
C 69800 47600 1 0 0 nmos-3.sym
{
T 70400 48100 5 10 0 0 180 8 1
device=NMOS_TRANSISTOR
T 69900 48100 5 10 1 1 0 8 1
refdes=Q?
}
C 67400 47600 1 0 0 nmos-3.sym
{
T 68000 48100 5 10 0 0 180 8 1
device=NMOS_TRANSISTOR
T 67500 48100 5 10 1 1 0 8 1
refdes=Q?
}
C 68500 40200 1 0 0 nmos-3.sym
{
T 69100 40700 5 10 0 0 180 8 1
device=NMOS_TRANSISTOR
T 68600 40500 5 10 1 1 270 8 1
refdes=Q?
}
C 70100 40200 1 0 1 nmos-3.sym
{
T 69500 40700 5 10 0 0 180 2 1
device=NMOS_TRANSISTOR
T 70000 40500 5 10 1 1 270 6 1
refdes=Q?
}
C 69000 39000 1 90 0 schottky-1.sym
{
T 68328 39322 5 10 0 0 90 0 1
device=DIODE
T 68600 39500 5 10 1 1 180 0 1
refdes=D?
T 68168 39341 5 10 0 1 90 0 1
footprint=SOD80
}
N 69000 40200 69000 39900 4
N 68800 39900 69300 39900 4
C 68700 38700 1 0 0 gnd-1.sym
C 69100 37900 1 270 0 capacitor-2.sym
{
T 69800 37700 5 10 0 0 270 0 1
device=POLARIZED_CAPACITOR
T 69000 37500 5 10 1 1 0 0 1
refdes=C?
T 70000 37700 5 10 0 0 270 0 1
symversion=0.1
}
C 69200 36700 1 0 0 gnd-1.sym
N 71300 48100 72200 48100 4
N 69800 46700 69200 46700 4
{
T 69100 46600 5 10 1 1 0 6 1
netname=VSENSE1_EN
}
N 70300 46700 70300 47600 4
N 70300 45800 70300 45600 4
N 55500 38000 54700 38000 4
{
T 54600 37900 5 10 1 1 0 6 1
netname=CH1_IN_B
}
N 55500 40400 54700 40400 4
{
T 54600 40300 5 10 1 1 0 6 1
netname=CH1_EN_A
}
